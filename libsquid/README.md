## liblogsquid

It's a library of utility functions to manipulate the registration line generated by the Squid-cache proxy.<br>
The main function *log_squid()*, allows us to retrieve only the information from the part of the log that interests us in a very simple way.<br>
The motivation to write these routines, in addition to the study and improvement of techniques, was due to the fact that this type of approach frees us from the SERDE routines in Java, usually written for data collection systems such as Apache Flume.<br>
So, very naturally, we can use these functions directly in SQL statements.

When we need new functions or have ideas about a new function, we will implement it in the project.


## Instructions

### To compile and install liblocation

git clone https://github.com/vcputtini/mysql-mariadb-udf-cpp  <br>
cd libsquid  <br>
make            <br>
make install    <br>  

### Create UDF's

To create (register) the UDF's to used in the database, we will use the DDL's that are encoded in the __docs/create-functions.sql__ file.

__Line command:__ Using mysql command.

mysql [-p] [-D test] <  docs/create-funcs.sql

## References
* Syntax<br>
Type: Aggregation<br>
_INTEGER log_squid_sum(string,string,string);_<br>
Arguments:<br>
1st: One these: squid | common | combined<br>
2nd: response_time | total_size_req<br>
3rd: Log line<br>
Comments: This function returns the sumatory of the values referring to the response_time and total_size_req.<br>

![](docs/ex01.png)<br>
![](docs/ex02.png)

* Syntax<br>
Type: function
_string log_squid(string,string,string);_<br>
Arguments:<br>
1st: One these: squid | common | combined | referrer | useragent<br>
2nd: Reserved Words: see list docs/reserved-words.txt<br>
3rd: Log line<br>
Comments: The function will always return the values in the string type.

* Supported Squid Log Formats<br>
Up to this point the *log_squid()* can handle the default formats of Squid's log types, as follows:<br><br>
Log Format: squid<br>
%ts.%03tu %6tr %>a %Ss/%03>Hs %<st %rm %ru %[un %Sh/%<a %mt<br>
UDF Reserved Word: squid<br><br>
Log Format: common<br>
%>a %[ui %[un [%tl] "%rm %ru HTTP/%rv" %>Hs %<st %Ss:%Sh<br>
UDF Reserved Word: common<br><br>
Log Format: combined<br>
%>a %[ui %[un [%tl] "%rm %ru HTTP/%rv" %>Hs %<st "%{Referer}>h" "%{User-Agent}>h" %Ss:%Sh<br>
UDF Reserved Word: combined<br><br>
Log Format: referrer<br>
%ts.%03tu %>a %{Referer}>h %ru<br>
UDF Reserved Word: referrer<br><br>
Log Format: useragent<br>
%>a [%tl] "%{User-Agent}>h"<br>
UDF Reserved Word: useragent<br>

* Reserved words to retrieve parts of the log<br>
The complete list of words reserved for use in the function can be found in the *docs/reserved-words.txt* file

* Usage Examples<br>
![](docs/ex03.png)<br>
![](docs/ex04.png)<br>
![](docs/ex05.png)<br>
![](docs/ex06.png)
